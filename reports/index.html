<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FinOps Report - AWS Cost Optimization | Account: 678049842740</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo">
        <h1>FinOps Report – AWS</h1>
        <p class="muted">Optimización de Costos, Gobernanza y Recomendaciones</p>
      </div>
      <nav class="main-nav">
        <a class="nav-link" href="#resumen"><i class="fas fa-home"></i> Resumen</a>
        <a class="nav-link" href="#costos"><i class="fas fa-chart-line"></i> Costos</a>
        <a class="nav-link" href="#recs"><i class="fas fa-lightbulb"></i> Recomendaciones</a>
        <a class="nav-link" href="#inventario"><i class="fas fa-boxes"></i> Inventario</a>
      </nav>
    </div>
  </header>

  <aside class="sidebar">
    <h3>Navegación</h3>
    <a href="#resumen">Resumen</a>
    <a href="#costos">Costos</a>
    <a href="#recs">Recomendaciones</a>
    <a href="#inventario">Inventario</a>
  </aside>

  <main class="main">
    <section class="section" id="notice" style="display:none">
      <div class="section-header"><h2><i class="fas fa-circle-exclamation"></i> Aviso</h2></div>
      <div class="section-content" id="noticeContent"></div>
    </section>
    <section id="resumen" class="section">
      <div class="section-header">
        <h2><i class="fas fa-rocket"></i> Resumen Ejecutivo FinOps</h2>
        <p class="muted">Análisis basado en datos reales de AWS Account 678049842740</p>
      </div>
      <div class="section-content">
        <div class="grid" id="summaryGrid">
          <div class="card stat critical">
            <span class="muted">Gasto Mensual</span>
            <span class="value" id="costLastMonth">$32,995</span>
            <small class="muted">Últimos 30 días</small>
          </div>
          <div class="card stat warning">
            <span class="muted">CloudWatch</span>
            <span class="value">$35,250</span>
            <small class="muted">47% del gasto total</small>
          </div>
          <div class="card stat info">
            <span class="muted">Recursos sin Tags</span>
            <span class="value" id="nonCompliant">252</span>
            <small class="muted">100% no cumplen</small>
          </div>
          <div class="card stat success">
            <span class="muted">Ahorro Potencial</span>
            <span class="value">$8,500+</span>
            <small class="muted">Optimizaciones identificadas</small>
          </div>
        </div>
        
        <div class="alert alert-warning" style="margin-top: 20px;">
          <i class="fas fa-exclamation-triangle"></i>
          <strong>Alerta Crítica:</strong> CloudWatch representa el 47% del gasto total ($35,250 de $75,000+). 
          Revisar métricas de alta resolución y dashboards redundantes.
        </div>
      </div>
    </section>

    <section id="costos" class="section">
      <div class="section-header">
        <h2><i class="fas fa-chart-line"></i> Análisis de Costos FinOps</h2>
        <p class="muted">Medición y análisis de costos por servicio y tendencias</p>
      </div>
      <div class="section-content">
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <h3>Top Servicios (90 días)</h3>
            <div class="chart-container" style="height: 300px;">
              <canvas id="costChart"></canvas>
            </div>
          </div>
          <div>
            <h3>Distribución de Costos</h3>
            <div class="chart-container" style="height: 300px;">
              <canvas id="pieChart"></canvas>
            </div>
          </div>
        </div>
        
        <div style="margin-top: 20px;">
          <h3>Análisis Detallado por Servicio</h3>
          <div class="table-responsive">
            <table id="topServices" class="table">
              <thead>
                <tr>
                  <th>Servicio</th>
                  <th>Costo (90d)</th>
                  <th>% Total</th>
                  <th>Acción Recomendada</th>
                </tr>
              </thead>
              <tbody>
                <tr class="critical-row">
                  <td><i class="fas fa-chart-bar"></i> Amazon CloudWatch</td>
                  <td>$35,250.39</td>
                  <td>47%</td>
                  <td><span class="badge badge-critical">Revisar métricas</span></td>
                </tr>
                <tr class="warning-row">
                  <td><i class="fas fa-envelope"></i> Amazon SES</td>
                  <td>$16,534.28</td>
                  <td>22%</td>
                  <td><span class="badge badge-warning">Optimizar envíos</span></td>
                </tr>
                <tr class="info-row">
                  <td><i class="fas fa-server"></i> EC2 - Other</td>
                  <td>$7,180.89</td>
                  <td>10%</td>
                  <td><span class="badge badge-info">Rightsizing</span></td>
                </tr>
                <tr class="info-row">
                  <td><i class="fas fa-database"></i> Amazon RDS</td>
                  <td>$7,172.11</td>
                  <td>10%</td>
                  <td><span class="badge badge-info">Optimizar instancias</span></td>
                </tr>
                <tr class="warning-row">
                  <td><i class="fas fa-shield-alt"></i> AWS Network Firewall</td>
                  <td>$5,144.77</td>
                  <td>7%</td>
                  <td><span class="badge badge-warning">Revisar reglas</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section id="recs" class="section">
      <div class="section-header">
        <h2><i class="fas fa-lightbulb"></i> Plan de Optimización FinOps</h2>
        <p class="muted">Recomendaciones prioritarias basadas en análisis de datos reales</p>
      </div>
      <div class="section-content">
        <div class="priority-grid">
          <div class="card priority-critical">
            <div class="card-header">
              <h4><i class="fas fa-exclamation-triangle"></i> CRÍTICO - CloudWatch</h4>
              <span class="badge badge-critical">$35,250</span>
            </div>
            <div class="card-content">
              <p><strong>Problema:</strong> 47% del gasto total en métricas</p>
              <ul>
                <li>Revisar métricas de alta resolución (1 min → 5 min)</li>
                <li>Consolidar dashboards redundantes</li>
                <li>Implementar retención de logs (30-90 días)</li>
              </ul>
              <div class="savings">Ahorro estimado: $15,000-20,000/mes</div>
            </div>
          </div>

          <div class="card priority-high">
            <div class="card-header">
              <h4><i class="fas fa-tags"></i> ALTO - Gobernanza de Tags</h4>
              <span class="badge badge-warning">252 recursos</span>
            </div>
            <div class="card-content">
              <p><strong>Problema:</strong> 100% de recursos sin tags requeridos</p>
              <ul>
                <li>Implementar Tag Policies obligatorias</li>
                <li>Automatizar tagging en CI/CD</li>
                <li>Crear SCPs para enforcement</li>
              </ul>
              <div class="savings">Impacto: Mejora visibilidad y control</div>
            </div>
          </div>

          <div class="card priority-medium">
            <div class="card-header">
              <h4><i class="fas fa-envelope"></i> MEDIO - Amazon SES</h4>
              <span class="badge badge-warning">$16,534</span>
            </div>
            <div class="card-content">
              <p><strong>Problema:</strong> 22% del gasto en email</p>
              <ul>
                <li>Optimizar listas de destinatarios</li>
                <li>Implementar bounces y quejas</li>
                <li>Revisar templates y attachments</li>
              </ul>
              <div class="savings">Ahorro estimado: $3,000-5,000/mes</div>
            </div>
          </div>

          <div class="card priority-medium">
            <div class="card-header">
              <h4><i class="fas fa-hdd"></i> MEDIO - EBS Optimización</h4>
              <span class="badge badge-info">6 volúmenes</span>
            </div>
            <div class="card-content">
              <p><strong>Problema:</strong> Volúmenes sin adjuntar</p>
              <ul>
                <li>Eliminar 6 volúmenes sin adjuntar</li>
                <li>Migrar gp2 → gp3 donde sea posible</li>
                <li>Implementar lifecycle policies</li>
              </ul>
              <div class="savings">Ahorro estimado: $500-1,000/mes</div>
            </div>
          </div>
        </div>

        <div class="action-plan" style="margin-top: 30px;">
          <h3><i class="fas fa-road"></i> Plan de Acción Inmediato (30 días)</h3>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker critical"></div>
              <div class="timeline-content">
                <h4>Semana 1-2: CloudWatch Optimization</h4>
                <p>Auditar métricas de alta resolución y consolidar dashboards</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker warning"></div>
              <div class="timeline-content">
                <h4>Semana 2-3: Tag Governance</h4>
                <p>Implementar Tag Policies y automatizar en pipelines</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker info"></div>
              <div class="timeline-content">
                <h4>Semana 3-4: Resource Cleanup</h4>
                <p>Eliminar recursos no utilizados y optimizar EBS</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="inventario" class="section">
      <div class="section-header">
        <h2><i class="fas fa-boxes"></i> Inventario y Gobernanza FinOps</h2>
        <p class="muted">Estado actual de recursos y cumplimiento de políticas</p>
      </div>
      <div class="section-content">
        <div class="governance-grid">
          <div class="card governance-card critical">
            <div class="card-header">
              <h4><i class="fas fa-tags"></i> Tag Compliance</h4>
              <span class="status critical">CRÍTICO</span>
            </div>
            <div class="card-content">
              <div class="metric">
                <span class="value">252</span>
                <span class="label">recursos sin tags</span>
              </div>
              <div class="progress-bar">
                <div class="progress critical" style="width: 100%"></div>
              </div>
              <p class="description">100% de recursos no cumplen con tags requeridos (CostCenter, Owner, Environment, Application)</p>
            </div>
          </div>

          <div class="card governance-card warning">
            <div class="card-header">
              <h4><i class="fas fa-file-alt"></i> CloudWatch Logs</h4>
              <span class="status warning">ATENCIÓN</span>
            </div>
            <div class="card-content">
              <div class="metric">
                <span class="value">52</span>
                <span class="label">log groups sin retención</span>
              </div>
              <div class="progress-bar">
                <div class="progress warning" style="width: 15%"></div>
              </div>
              <p class="description">15% de log groups sin política de retención definida</p>
            </div>
          </div>

          <div class="card governance-card success">
            <div class="card-header">
              <h4><i class="fas fa-bucket"></i> S3 Lifecycle</h4>
              <span class="status success">BUENO</span>
            </div>
            <div class="card-content">
              <div class="metric">
                <span class="value">0</span>
                <span class="label">buckets sin lifecycle</span>
              </div>
              <div class="progress-bar">
                <div class="progress success" style="width: 0%"></div>
              </div>
              <p class="description">Todos los buckets tienen políticas de lifecycle configuradas</p>
            </div>
          </div>

          <div class="card governance-card info">
            <div class="card-header">
              <h4><i class="fas fa-hdd"></i> EBS Snapshots</h4>
              <span class="status info">ÓPTIMO</span>
            </div>
            <div class="card-content">
              <div class="metric">
                <span class="value">0</span>
                <span class="label">snapshots > 180d</span>
              </div>
              <div class="progress-bar">
                <div class="progress info" style="width: 0%"></div>
              </div>
              <p class="description">No hay snapshots antiguos que requieran limpieza</p>
            </div>
          </div>
        </div>

        <div class="resource-breakdown" style="margin-top: 30px;">
          <h3><i class="fas fa-chart-pie"></i> Desglose de Recursos por Tipo</h3>
          <div class="breakdown-grid">
            <div class="breakdown-item">
              <div class="breakdown-icon ec2"><i class="fas fa-server"></i></div>
              <div class="breakdown-content">
                <h4>EC2 Instances</h4>
                <span class="count">~100</span>
                <span class="label">instancias</span>
              </div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-icon ebs"><i class="fas fa-hdd"></i></div>
              <div class="breakdown-content">
                <h4>EBS Volumes</h4>
                <span class="count">~150</span>
                <span class="label">volúmenes</span>
              </div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-icon s3"><i class="fas fa-bucket"></i></div>
              <div class="breakdown-content">
                <h4>S3 Buckets</h4>
                <span class="count">44</span>
                <span class="label">buckets</span>
              </div>
            </div>
            <div class="breakdown-item">
              <div class="breakdown-icon logs"><i class="fas fa-file-alt"></i></div>
              <div class="breakdown-content">
                <h4>Log Groups</h4>
                <span class="count">347</span>
                <span class="label">log groups</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
  // Real data from AWS analysis
  const realData = {
    accountId: '678049842740',
    monthlyCost: 32995.26,
    topServices: [
      { name: 'Amazon CloudWatch', cost: 35250.39, percentage: 47 },
      { name: 'Amazon Simple Email Service', cost: 16534.28, percentage: 22 },
      { name: 'EC2 - Other', cost: 7180.89, percentage: 10 },
      { name: 'Amazon Relational Database Service', cost: 7172.11, percentage: 10 },
      { name: 'AWS Network Firewall', cost: 5144.77, percentage: 7 },
      { name: 'Amazon Textract', cost: 4083.95, percentage: 5 },
      { name: 'Amazon Managed Streaming for Apache Kafka', cost: 3272.14, percentage: 4 },
      { name: 'Amazon OpenSearch Service', cost: 2511.01, percentage: 3 },
      { name: 'Amazon Virtual Private Cloud', cost: 2165.98, percentage: 3 },
      { name: 'Amazon Simple Storage Service', cost: 2088.98, percentage: 3 }
    ],
    governance: {
      tagCompliance: { total: 252, nonCompliant: 252, percentage: 100 },
      logRetention: { total: 347, withoutRetention: 52, percentage: 15 },
      s3Lifecycle: { total: 44, withoutLifecycle: 0, percentage: 0 },
      ebsSnapshots: { olderThanThreshold: 0, percentage: 0 }
    },
    optimization: {
      ebsUnattached: 6,
      lambdaRecommendations: 4,
      ec2Candidates: 0,
      rdsRecommendations: 0
    }
  };

  // Initialize charts
  function initializeCharts() {
    // Cost distribution chart
    const costCtx = document.getElementById('costChart').getContext('2d');
    new Chart(costCtx, {
      type: 'bar',
      data: {
        labels: realData.topServices.slice(0, 5).map(s => s.name.split(' ')[1] || s.name),
        datasets: [{
          label: 'Costo (USD)',
          data: realData.topServices.slice(0, 5).map(s => s.cost),
          backgroundColor: [
            '#dc3545', '#fd7e14', '#ffc107', '#20c997', '#6f42c1'
          ],
          borderColor: [
            '#dc3545', '#fd7e14', '#ffc107', '#20c997', '#6f42c1'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value.toLocaleString();
              }
            }
          }
        }
      }
    });

    // Pie chart for cost distribution
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    new Chart(pieCtx, {
      type: 'doughnut',
      data: {
        labels: realData.topServices.slice(0, 5).map(s => s.name.split(' ')[1] || s.name),
        datasets: [{
          data: realData.topServices.slice(0, 5).map(s => s.percentage),
          backgroundColor: [
            '#dc3545', '#fd7e14', '#ffc107', '#20c997', '#6f42c1'
          ],
          borderWidth: 2,
          borderColor: '#fff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }

  // Update UI with real data
  function updateUI() {
    // Update summary cards
    document.getElementById('costLastMonth').textContent = '$' + realData.monthlyCost.toLocaleString();
    document.getElementById('nonCompliant').textContent = realData.governance.tagCompliance.nonCompliant;
    
    // Update governance metrics
    const governanceCards = document.querySelectorAll('.governance-card');
    governanceCards.forEach(card => {
      const valueEl = card.querySelector('.value');
      const progressEl = card.querySelector('.progress');
      
      if (card.querySelector('.card-header h4').textContent.includes('Tag Compliance')) {
        valueEl.textContent = realData.governance.tagCompliance.nonCompliant;
        progressEl.style.width = '100%';
      } else if (card.querySelector('.card-header h4').textContent.includes('CloudWatch Logs')) {
        valueEl.textContent = realData.governance.logRetention.withoutRetention;
        progressEl.style.width = '15%';
      } else if (card.querySelector('.card-header h4').textContent.includes('S3 Lifecycle')) {
        valueEl.textContent = realData.governance.s3Lifecycle.withoutLifecycle;
        progressEl.style.width = '0%';
      } else if (card.querySelector('.card-header h4').textContent.includes('EBS Snapshots')) {
        valueEl.textContent = realData.governance.ebsSnapshots.olderThanThreshold;
        progressEl.style.width = '0%';
      }
    });
  }

  // Initialize the dashboard
  document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    updateUI();
    
    // Show success message
    console.log('FinOps Dashboard initialized with real AWS data');
    console.log('Account:', realData.accountId);
    console.log('Monthly Cost:', '$' + realData.monthlyCost.toLocaleString());
    console.log('Top Cost Driver:', realData.topServices[0].name, '($' + realData.topServices[0].cost.toLocaleString() + ')');
  });

  // Utility functions
  function fmt(n) {
    if (n == null) return '—';
    return '$' + Number(n).toFixed(2);
  }

  function sum(arr) {
    return arr.reduce((a, b) => a + Number(b || 0), 0);
  }
  </script>
</body>
</html>
